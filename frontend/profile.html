<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - SpeakUpEngBot</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
<header>
    <div class="logo">
        <img src="https://img.alicdn.com/imgextra/i2/1797064093/O1CN01FTdSDT1g6e7p1HAv6_!!1797064093.png_.webp" alt="SpeakUpEngBot Logo">
    </div>
    <h1>SpeakUpEngBot</h1>
    <nav>
        <a href="index.html">Lessons</a>
        <a href="chat.html">Chat</a>
        <a href="profile.html">Profile</a>
    </nav>
</header>
<main class="container">
    <h2>Profile</h2>
    <div class="profile-container">
        <div class="profile-avatar">
            <img src="https://upload.wikimedia.org/wikipedia/commons/1/19/Audi_A7_Sportback_Genf_2018.jpg" alt="User Avatar">
        </div>
        <div class="profile-info">
            <h3 id="username">Loading...</h3>
            <p><strong>Joined:</strong> <span id="joined-date">Loading...</span></p>
        </div>
        <div class="progress-bar">
            <div class="progress" id="level-progress"></div>
        </div>
        <p><strong>Level:</strong> <span id="level">Loading...</span> | <strong>XP:</strong> <span id="xp">Loading...</span> | <strong>XP to Next Level:</strong> <span id="remaining-xp">Loading...</span></p>
        <div class="profile-actions">
            <button onclick="logout()">Log Out</button>
        </div>
    </div>
</main>
<script src="js/main.js"></script>
<script>
    const userId = checkAuth();
    if (userId) {
        apiRequest(`users/${userId}/profile`)
            .then(data => {
                document.getElementById('username').textContent = data.username;
                document.getElementById('level').textContent = data.calculatedLevel;
                document.getElementById('xp').textContent = data.xp;
                document.getElementById('remaining-xp').textContent = data.remainingXp;
                document.getElementById('joined-date').textContent = new Date(data.createdAt).toLocaleDateString('ru-RU');
                const progressPercent = (data.xp / (data.xp + data.remainingXp)) * 100;
                document.getElementById('level-progress').style.width = `${progressPercent}%`;
            })
            .catch(error => {
                document.querySelector('.profile-container').innerHTML = `<p class="error">Error loading profile: ${error.message}</p>`;
            });
    }

    function logout() {
        localStorage.removeItem('userId');
        window.location.href = 'login.html';
    }
</script>
</body>
</html>